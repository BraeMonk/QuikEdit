<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pixel Sprite Editor</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { font-family: sans-serif; padding: 10px; text-align: center; background: #1c1c1c; color: #fff; }
  #controls { margin-bottom: 10px; }
  #canvas { display: grid; touch-action: none; margin: 10px auto; border: 1px solid #555; }
  .cell { border: 1px solid #333; box-sizing: border-box; }
  button, select, input { margin: 5px; padding: 8px 16px; font-size: 14px; cursor: pointer; }
  #swatches { margin-top: 10px; }
  .swatch { display: inline-block; width: 30px; height: 30px; margin: 2px; border: 1px solid #333; cursor: pointer; }
  .swatch.selected { border: 3px solid #fff; }
  pre { text-align: left; max-width: 100%; overflow-x: auto; background: #222; padding: 10px; color: #fff; }
</style>
</head>
<body>

<h2>Pixel Sprite Editor</h2>

<div id="controls">
  Canvas Size:
  <select id="sizeSelector">
    <option value="8">8x8</option>
    <option value="16" selected>16x16</option>
    <option value="24">24x24</option>
    <option value="32">32x32</option>
    <option value="48">48x48</option>
    <option value="64">64x64</option>
  </select>

  Theme:
  <select id="paletteSelector"></select>

  Sprite:
  <select id="spriteSelector"></select>
  <button id="newSprite">New Sprite</button>

  <button id="undo">Undo</button>
  <button id="redo">Redo</button>
  <button id="clear">Clear</button>
  <button id="export">Export Array</button>
  <input type="file" id="importFile" accept=".json">
</div>

<div id="swatches"></div>
<div id="canvas"></div>
<pre id="output"></pre>

<script>
// ----------------------------
// Light/Dark mode toggle
// ----------------------------
const isLightMode = true; // change to false for dark variants

// ----------------------------
// Inline themes
// ----------------------------
const palettes = {
  default: isLightMode
      ? ['transparent','#8B5E3C','#FFD8A6','#5C3A25','#FFCB88','#8B5E3C','#FFD8A6','#A9745B','#FFE0B3','#6B4226']
      : ['transparent','#4a90e2','#ffffff','#1f5fbf','#9cc7f0','#4a90e2','#ffffff','#2b6fb2','#cce6ff','#173f80'],
  chaotic: isLightMode
      ? ['transparent','#8B0000','#FF4500','#4B0000','#FF6347','#8B0000','#FF4500','#B22222','#FF7F50','#6B0000']
      : ['transparent','#FF4500','#8B0000','#FF6347','#4B0000','#FF4500','#8B0000','#FF7F50','#B22222','#660000'],
  neutral: isLightMode
      ? ['transparent','#6A0DAD','#E0CFFF','#4B0082','#D8BFFF','#6A0DAD','#E0CFFF','#7D3C98','#F0D6FF','#3A0066']
      : ['transparent','#E0CFFF','#6A0DAD','#D8BFFF','#4B0082','#E0CFFF','#6A0DAD','#F0D6FF','#7D3C98','#330055'],
  noir: isLightMode
      ? ['transparent','#333333','#DDDDDD','#000000','#FFFFFF','#333333','#DDDDDD','#555555','#BBBBBB','#111111']
      : ['transparent','#DDDDDD','#333333','#FFFFFF','#000000','#DDDDDD','#333333','#BBBBBB','#555555','#111111'],
  forest: isLightMode
      ? ['transparent','#2E8B57','#A9DFBF','#1B5E20','#82E0AA','#2E8B57','#A9DFBF','#1A4720','#74D6A2','#145C17']
      : ['transparent','#A9DFBF','#2E8B57','#82E0AA','#1B5E20','#A9DFBF','#2E8B57','#74D6A2','#145C17','#1A4720'],
  neon: isLightMode
      ? ['transparent','#FF00FF','#00FFFF','#990099','#66FFFF','#FF00FF','#00FFFF','#CC00CC','#33FFFF','#660066']
      : ['transparent','#00FFFF','#FF00FF','#66FFFF','#990099','#00FFFF','#FF00FF','#33FFFF','#CC00CC','#660066'],
  solar: isLightMode
      ? ['transparent','#FF8C00','#FFF5CC','#CC7000','#FFD580','#FF8C00','#FFF5CC','#E67E22','#FFE6A3','#B35900']
      : ['transparent','#FFD580','#FF8C00','#FFF5CC','#CC7000','#FFD580','#FF8C00','#FFE6A3','#E67E22','#B35900'],
  glacial: isLightMode
      ? ['transparent','#F0FAFF','#D6EAF8','#A9DDF2','#85C1E9','#B3E5FC','#AED6F1','#5DADE2','#2E86C1','#154360']
      : ['transparent','#EBF5FB','#AED6F1','#5DADE2','#D6EAF8','#A9DDF2','#EBF5FB','#AED6F1','#5DADE2','#154360'],
  cosmic: isLightMode
      ? ['transparent','#2C003E','#E0B0FF','#12001A','#8A2BE2','#2C003E','#E0B0FF','#5C1F80','#D8A0FF','#1A0010']
      : ['transparent','#8A2BE2','#E0B0FF','#2C003E','#12001A','#8A2BE2','#E0B0FF','#5C1F80','#D8A0FF','#1A0010'],
  blossom: isLightMode
      ? ['transparent','#E6E6FA','#FFE5B4','#98FB98','#FFFFFF','#E6E6FA','#FFE5B4','#D8BFD8','#FFF0D6','#90EE90']
      : ['transparent','#D8BFD8','#FFB07C','#66CDAA','#E6E6FA','#D8BFD8','#FFB07C','#B0A0C0','#FFCC99','#55AA88'],
  volt: isLightMode
      ? ['transparent','#FFD700','#FFFFFF','#FF8C00','#FFFF66','#FFD700','#FFFFFF','#FFC300','#FFFACD','#FF7F00']
      : ['transparent','#FFFF66','#FFD700','#FFFFFF','#FF8C00','#FFFF66','#FFD700','#FFFACD','#FFC300','#FF7F00'],
  retro: isLightMode
      ? ['transparent','#FF69B4','#00CED1','#8B008B','#FFD700','#FF69B4','#00CED1','#FF1493','#20B2AA','#800080']
      : ['transparent','#00CED1','#FF69B4','#FFD700','#8B008B','#00CED1','#FF69B4','#20B2AA','#FF1493','#800080'],
  lunar: isLightMode
      ? ['transparent','#F8F8FF','#C0C0C0','#B0C4DE','#E6E6FA','#F8F8FF','#C0C0C0','#D3D3F0','#E0E0E8','#B0B0C0']
      : ['transparent','#2F4F4F','#708090','#B0C4DE','#C0C0C0','#2F4F4F','#708090','#556B6B','#90A0A0','#404040'],
  binary: isLightMode
      ? ['transparent','#708090','#B22222','#32CD32','#D3D3D3','#708090','#B22222','#5A6B7D','#FF4040','#228B22']
      : ['transparent','#000000','#00FF00','#008000','#AAFFAA','#000000','#00FF00','#005500','#33FF33','#003300'],
  earthy: isLightMode 
      ? ['transparent','#8B5A2B','#A0522D','#556B2F','#6B8E23','#CD853F','#9ACD32','#7F5217','#B87333','#4F6228'] 
      : ['transparent','#654321','#8B4513','#228B22','#32CD32','#A0522D','#ADFF2F','#4B2E1F','#7C3600','#1F4D1F'],
  halloweenAutumn: isLightMode 
      ? ['transparent','#FF7518','#FFB347','#8B0000','#6B4226','#FFD700','#A0522D','#2F4F4F','#800080','#2C2C2C'] 
      : ['transparent','#FF4500','#CC7722','#B22222','#3E2723','#FF8C00','#8B4513','#191970','#4B0082','#000000'],
  harvestAutumn: isLightMode 
      ? ['transparent','#FFA500','#FFB733','#FF6347','#CD853F','#FFD700','#F4A460','#8B4513','#DAA520','#A0522D'] 
      : ['transparent','#FF8C00','#E97451','#B22222','#8B4513','#FFCC00','#D2691E','#654321','#B8860B','#5C3317']
};

// ----------------------------
// State
// ----------------------------
let colors = palettes.default;
let array = [];
let canvasSize = 16;
let selectedColor = 0;
let undoStack = [];
let redoStack = [];
let allSprites = [];
let currentSpriteIndex = 0;

const canvas = document.getElementById('canvas');
const sizeSelector = document.getElementById('sizeSelector');
const paletteSelector = document.getElementById('paletteSelector');
const spriteSelector = document.getElementById('spriteSelector');
let isPainting = false;

// ----------------------------
// Populate Theme Selector
// ----------------------------
for(let theme in palettes){
  const opt = document.createElement('option');
  opt.value = theme;
  opt.textContent = theme;
  paletteSelector.appendChild(opt);
}
paletteSelector.value='default';

// ----------------------------
// Functions
// ----------------------------
function renderSwatches(){
  const swatchesDiv = document.getElementById('swatches');
  swatchesDiv.innerHTML='';
  colors.forEach((color,index)=>{
    const swatch = document.createElement('div');
    swatch.className='swatch';
    if(index===selectedColor) swatch.classList.add('selected');
    swatch.style.background=color;
    swatch.addEventListener('click',()=>{ selectedColor=index; renderSwatches(); });
    swatchesDiv.appendChild(swatch);
  });
}

function saveState(){
  undoStack.push(array.map(r=>r.slice()));
  if(undoStack.length>50) undoStack.shift();
  redoStack=[];
}

function paintCell(cell){
  saveState();
  const x=parseInt(cell.dataset.x);
  const y=parseInt(cell.dataset.y);
  array[y][x]=selectedColor;
  cell.dataset.value=selectedColor;
  cell.style.background=colors[selectedColor];
}

function renderCanvas(){
  canvas.innerHTML='';
  const cellSize=Math.floor(Math.min(480, window.innerWidth-20)/canvasSize);
  canvas.style.gridTemplateColumns=`repeat(${canvasSize},${cellSize}px)`;
  canvas.style.gridTemplateRows=`repeat(${canvasSize},${cellSize}px)`;

  for(let y=0;y<canvasSize;y++){
    for(let x=0;x<canvasSize;x++){
      const cell=document.createElement('div');
      cell.className='cell';
      cell.dataset.x=x;
      cell.dataset.y=y;
      cell.dataset.value=array[y][x];
      cell.style.width=`${cellSize}px`;
      cell.style.height=`${cellSize}px`;
      cell.style.background=colors[array[y][x]];

      cell.addEventListener('mousedown',()=>{ isPainting=true; paintCell(cell); });
      cell.addEventListener('mouseenter',()=>{ if(isPainting) paintCell(cell); });
      cell.addEventListener('mouseup',()=>{ isPainting=false; });

      cell.addEventListener('touchstart',(e)=>{ paintCell(cell); e.preventDefault(); });
      cell.addEventListener('touchmove',(e)=>{
        const t=e.touches[0];
        const target=document.elementFromPoint(t.clientX,t.clientY);
        if(target && target.classList.contains('cell')) paintCell(target);
        e.preventDefault();
      });

      canvas.appendChild(cell);
    }
  }
  renderSwatches();
  document.body.addEventListener('mouseup',()=>isPainting=false);
}

function updateCanvasColors(){
  document.querySelectorAll('.cell').forEach(cell=>{
    cell.style.background=colors[parseInt(cell.dataset.value)];
  });
}

// ----------------------------
// Sprite functions
// ----------------------------
function loadSprite(index){
  if(!allSprites[index]) return;
  array = allSprites[index].map(r=>r.slice());
  undoStack=[];
  redoStack=[];
  renderCanvas();
  currentSpriteIndex=index;
}

function addNewSprite(){
  const newSprite = Array.from({length:canvasSize},()=>Array(canvasSize).fill(0));
  allSprites.push(newSprite);
  const opt = document.createElement('option');
  opt.value = allSprites.length-1;
  opt.textContent = `Sprite ${allSprites.length}`;
  spriteSelector.appendChild(opt);
  spriteSelector.value = allSprites.length-1;
  loadSprite(allSprites.length-1);
}

// ----------------------------
// Init
// ----------------------------
function initCanvas(){
  array = Array.from({length:canvasSize},()=>Array(canvasSize).fill(0));
  allSprites = [array.map(r=>r.slice())];
  spriteSelector.innerHTML='<option value="0">Sprite 1</option>';
  currentSpriteIndex = 0;
  renderCanvas();
}
initCanvas();

// ----------------------------
// Event Listeners
// ----------------------------
paletteSelector.addEventListener('change',()=>{
  colors = palettes[paletteSelector.value];
  selectedColor = 0;
  renderSwatches();
  updateCanvasColors();
});

sizeSelector.addEventListener('change',()=>{
  canvasSize=parseInt(sizeSelector.value);
  initCanvas();
});

spriteSelector.addEventListener('change',()=>{
  loadSprite(parseInt(spriteSelector.value));
});

document.getElementById('newSprite').addEventListener('click',addNewSprite);

document.getElementById('undo').addEventListener('click',()=>{
  if(undoStack.length){
    redoStack.push(array.map(r=>r.slice()));
    array = undoStack.pop().map(r=>r.slice());
    renderCanvas();
  }
});
document.getElementById('redo').addEventListener('click',()=>{
  if(redoStack.length){
    undoStack.push(array.map(r=>r.slice()));
    array = redoStack.pop().map(r=>r.slice());
    renderCanvas();
  }
});
document.getElementById('clear').addEventListener('click',()=>{
  saveState();
  array=Array.from({length:canvasSize},()=>Array(canvasSize).fill(0));
  renderCanvas();
});

// Export
document.getElementById('export').addEventListener('click',()=>{
  allSprites[currentSpriteIndex] = array.map(r=>r.slice());
  const exportData = allSprites.map(spr=>spr.flat());
  document.getElementById('output').textContent=JSON.stringify(exportData,null,4);
});

// Import
document.getElementById('importFile').addEventListener('change',e=>{
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload=function(evt){
    try{
      const imported = JSON.parse(evt.target.result);

      // Multiple sprites
      if(Array.isArray(imported[0]) && Array.isArray(imported[0][0])){
        allSprites = imported.map(spr=>{
          if(spr.length !== canvasSize*canvasSize) throw 'Sprite size mismatch';
          let grid = [];
          for(let y=0;y<canvasSize;y++){
            grid.push(spr.slice(y*canvasSize,(y+1)*canvasSize));
          }
          return grid;
        });
      } else {
        // Single sprite
        if(imported.length !== canvasSize*canvasSize) throw 'Invalid array length';
        let grid = [];
        for(let y=0;y<canvasSize;y++){
          grid.push(imported.slice(y*canvasSize,(y+1)*canvasSize));
        }
        allSprites = [grid];
      }

      // Populate selector
      spriteSelector.innerHTML='';
      allSprites.forEach((_,i)=>{
        const opt = document.createElement('option');
        opt.value=i;
        opt.textContent=`Sprite ${i+1}`;
        spriteSelector.appendChild(opt);
      });
      currentSpriteIndex=0;
      spriteSelector.value=0;
      loadSprite(0);

    }catch(err){
      alert('Invalid JSON file: '+err);
    }
  };
  reader.readAsText(file);
});
</script>

</body>
</html>
